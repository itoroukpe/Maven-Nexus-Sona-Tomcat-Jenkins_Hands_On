Here’s a **step-by-step guide** on how to upload artifacts to **Nexus Repository Manager** using both **manual upload** and the **`mvn deploy` command**:

---

## **1. Manual Upload to Nexus Repository Manager**

### **Step 1: Prepare Artifact Files**
You’ll need the following files typically generated by a Maven build:
- `your-artifact-1.0.jar`
- `your-artifact-1.0.pom` (Maven POM file)
- Optionally: `your-artifact-1.0-sources.jar`, `your-artifact-1.0-javadoc.jar`, etc.

### **Step 2: Log in to Nexus**
1. Open Nexus in a browser: `http://<your-nexus-host>:8081/`
2. Login with an admin or authorized user account.

### **Step 3: Navigate to Repositories**
1. Go to **"Repositories"** under **"Server Administration and Configuration"**
2. Choose your target repository (e.g., `maven-releases` or `maven-snapshots`)

### **Step 4: Upload the Artifact**
1. Click **"Artifacts"** in the left sidebar.
2. Click **"Upload"**.
3. Select the target repository.
4. Use **"Upload component manually"** option.
5. Choose **format = maven2**.
6. Enter **Group ID**, **Artifact ID**, **Version**, **Packaging**.
7. Upload `.jar`, `.pom`, and any additional files.
8. Click **"Upload"** to publish.

---

## **2. Upload Using `mvn deploy` Command**

### **Step 1: Configure `distributionManagement` in `pom.xml`**
Add the following section to your `pom.xml`:

```xml
<distributionManagement>
    <repository>
        <id>nexus-releases</id>
        <url>http://<your-nexus-host>:8081/repository/maven-releases/</url>
    </repository>
    <snapshotRepository>
        <id>nexus-snapshots</id>
        <url>http://<your-nexus-host>:8081/repository/maven-snapshots/</url>
    </snapshotRepository>
</distributionManagement>
```

### **Step 2: Add Server Credentials in `settings.xml`**
Edit your `~/.m2/settings.xml` file:

```xml
<servers>
    <server>
        <id>nexus-releases</id>
        <username>your-username</username>
        <password>your-password</password>
    </server>
    <server>
        <id>nexus-snapshots</id>
        <username>your-username</username>
        <password>your-password</password>
    </server>
</servers>
```

### **Step 3: Deploy Artifact Using Maven**
Run this command in your project directory:

```bash
mvn clean deploy
```

This will:
- Build your artifact
- Generate a `.pom` file
- Deploy both to the Nexus repository (releases or snapshots based on version)

---

## **Tips**
- If you're deploying a **snapshot** version, make sure your version is like `1.0-SNAPSHOT`.
- If you're deploying a **release**, use a version like `1.0` (no `-SNAPSHOT`).
- Use **GPG signing** if your repository requires it (`mvn deploy -Psign-artifacts`).

---
Great! Here's both a **manual upload automation script (using Nexus REST API)** and a **Maven `deploy` template** for automation with the `mvn deploy` command.

---

## **1. Script: Automate Manual Upload via Nexus REST API**

This example uses `curl` to upload a Maven artifact to Nexus 3:

### **Bash Script: `upload-to-nexus.sh`**
```bash
#!/bin/bash

# === CONFIGURATION ===
NEXUS_URL="http://<your-nexus-host>:8081"
REPO="maven-releases"  # or maven-snapshots
GROUP_ID="com.example"
ARTIFACT_ID="my-lib"
VERSION="1.0.0"
PACKAGING="jar"
USERNAME="your-username"
PASSWORD="your-password"

# === FILES TO UPLOAD ===
ARTIFACT_JAR="target/my-lib-1.0.0.jar"
ARTIFACT_POM="target/my-lib-1.0.0.pom"

# Convert groupId to path
GROUP_PATH=$(echo "$GROUP_ID" | tr '.' '/')

# Upload artifact
curl -v -u "$USERNAME:$PASSWORD" --upload-file "$ARTIFACT_JAR" \
  "$NEXUS_URL/repository/$REPO/$GROUP_PATH/$ARTIFACT_ID/$VERSION/$ARTIFACT_ID-$VERSION.$PACKAGING"

# Upload POM
curl -v -u "$USERNAME:$PASSWORD" --upload-file "$ARTIFACT_POM" \
  "$NEXUS_URL/repository/$REPO/$GROUP_PATH/$ARTIFACT_ID/$VERSION/$ARTIFACT_ID-$VERSION.pom"
```

> **Make it executable**:
```bash
chmod +x upload-to-nexus.sh
./upload-to-nexus.sh
```

---

## **2. Maven Deploy Automation Template**

### **In `pom.xml`**:
```xml
<distributionManagement>
    <repository>
        <id>nexus-releases</id>
        <name>Nexus Release Repo</name>
        <url>http://<your-nexus-host>:8081/repository/maven-releases/</url>
    </repository>
    <snapshotRepository>
        <id>nexus-snapshots</id>
        <name>Nexus Snapshot Repo</name>
        <url>http://<your-nexus-host>:8081/repository/maven-snapshots/</url>
    </snapshotRepository>
</distributionManagement>
```

### **In `~/.m2/settings.xml`**:
```xml
<servers>
  <server>
    <id>nexus-releases</id>
    <username>your-username</username>
    <password>your-password</password>
  </server>
  <server>
    <id>nexus-snapshots</id>
    <username>your-username</username>
    <password>your-password</password>
  </server>
</servers>
```

### **To Deploy Automatically**:
```bash
mvn clean deploy
```

---
Yes, Nexus Repository Manager **supports token-based authentication** (via user **Access Tokens** or **API Keys**) as an alternative to basic username/password. This is highly recommended for CI/CD systems and scripts.

Below is a **step-by-step guide** to **generate a token** in Nexus Repository Manager 3 (Sonatype Nexus 3.x):

---

## **How to Generate a Token (API Key) in Nexus Repository Manager 3**

### **Step 1: Login to Nexus**
- Open your Nexus Repository Manager in a browser:  
  `http://<your-nexus-host>:8081/`
- Login with your **username and password**.

---

### **Step 2: Enable or Access User Token Feature**
1. Click your **user icon** in the upper-right corner.
2. Click **"Profile"** or go to **"Security" > "Users"** if you're an admin.
3. Find and click your **username**.
4. Look for a section/tab called **"User Token"** or **"Access Token"**.

If it’s not visible:
- Ask your Nexus admin to **enable the feature** or
- Make sure your role has the correct **permissions** (e.g., `nx-user-token`).

---

### **Step 3: Generate a New Token**
1. Click **"Access User Token"** or **"Generate Token"**.
2. You'll get:
   - **Username**
   - **Password (Token)**

This token acts like your credentials for automation and scripts.

---

### **Step 4: Use Token in Maven Settings**

Update `~/.m2/settings.xml` with the token:

```xml
<servers>
  <server>
    <id>nexus-releases</id>
    <username>deployment-user</username>
    <password>your-generated-token</password>
  </server>
</servers>
```

Or use the full token in the script:

```bash
USERNAME="deployment-user"
PASSWORD="your-generated-token"
```

---

### **Optional: Reset or Revoke Token**
- Return to the **User Token** page.
- Click **"Reset Token"** to generate a new one or **"Revoke"** to disable it.

---
Here’s a **secure way to manage and inject a Nexus token in Jenkins** pipelines — ensuring your credentials are not exposed in code or logs.

---

## ✅ **Secure Token Management in Jenkins**

### **Step 1: Generate Your Nexus Token**
Follow the previous steps to generate a **user token** or **API key** in Nexus.

---

### **Step 2: Add Nexus Credentials to Jenkins**

1. **Go to Jenkins Dashboard**  
   → **Manage Jenkins**  
   → **Credentials**  
   → Choose the right **domain** (usually `(global)`).

2. Click **“Add Credentials”**

3. Set:
   - **Kind**: `Username with password`
   - **Username**: your Nexus username (or the token username, e.g., `deployment-user`)
   - **Password**: your Nexus API token
   - **ID**: something memorable like `nexus-token`
   - **Description**: e.g., “Nexus Deployment Token”

4. Click **Save**

---

## 🚀 **Use Nexus Token Securely in Jenkins Pipeline**

### **Option 1: Declarative Pipeline Example**
```groovy
pipeline {
    agent any

    environment {
        MAVEN_HOME = tool 'Maven 3.8' // or your configured Maven tool
    }

    stages {
        stage('Deploy to Nexus') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'nexus-token', usernameVariable: 'NEXUS_USER', passwordVariable: 'NEXUS_PASS')]) {
                    sh '''
                        mvn deploy \
                        -Dnexus.username=$NEXUS_USER \
                        -Dnexus.password=$NEXUS_PASS
                    '''
                }
            }
        }
    }
}
```

> In your `pom.xml`, you can pass the `username`/`password` via properties, or use Maven settings.xml.

---

### **Option 2: With Maven `settings.xml` in Jenkins**

1. Create a `settings.xml` template like this:

```xml
<servers>
  <server>
    <id>nexus-releases</id>
    <username>${env.NEXUS_USER}</username>
    <password>${env.NEXUS_PASS}</password>
  </server>
</servers>
```

2. Save this file in your project (or configure Jenkins to load it dynamically).

3. Modify your Maven deploy step to use this custom file:
```groovy
sh '''
  mvn deploy --settings ./jenkins-settings.xml
'''
```

---

## 🔒 Best Practices

- **Never hardcode tokens** in your Jenkinsfiles or scripts.
- Use **Jenkins credentials binding** to avoid leaking secrets in logs.
- Mask sensitive variables in logs using `withCredentials`.
- Consider using a **dedicated Nexus user** with limited permissions (i.e., `deployment` role only).

---

### Error you are seeing: 
```
[ERROR] The specified user settings file does not exist: /home/ec2-user/.m2/settings.xml
```

---

## ✅ What this means:
Maven is trying to use your `settings.xml` at the **exact path**:
```
/home/ec2-user/.m2/settings.xml
```
…but **it doesn't exist** there.

---

## ✅ How to fix it (step-by-step):

### 🔹 **Step 1: Create the `.m2` folder if needed**
```bash
mkdir -p /home/ec2-user/.m2
```

---

### 🔹 **Step 2: Create or paste in your `settings.xml`**
Run this to open the file for editing:
```bash
nano /home/ec2-user/.m2/settings.xml
```

Then paste in the following **corrected content**:

```xml
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                              https://maven.apache.org/xsd/settings-1.0.0.xsd">
    <servers>
        <server>
            <id>nexus-releases</id>
            <username>admin</username>
            <password>YOUR_TOKEN_HERE</password>
        </server>
        <server>
            <id>nexus-snapshots</id>
            <username>admin</username>
            <password>YOUR_TOKEN_HERE</password>
        </server>
    </servers>
</settings>
```

> Replace `YOUR_TOKEN_HERE` with your actual Nexus token.

Save and exit with: `Ctrl + O`, `Enter`, then `Ctrl + X`.

---

### 🔹 **Step 3: Re-run the deploy command**
```bash
mvn clean deploy -s /home/ec2-user/.m2/settings.xml
```

✅ If everything’s correct, this should now work and deploy your artifact successfully.

---

### The error you're seeing:

```
Failed to delete /home/ec2-user/maven-web-application/target/maven-web-application.war
```

means that Maven tried to **clean the project**, but it couldn't delete the WAR file — most likely because:

### 🔒 **Something is still using the file** — either:
- A server (like Jetty or Tomcat) is running and has the WAR open.
- The file permissions are locked down.
- A previous `mvn jetty:run` process wasn’t stopped correctly.

---

## ✅ **How to fix it (step-by-step)**

---

### 🔹 **Step 1: Manually delete the target folder**

```bash
rm -rf /home/ec2-user/maven-web-application/target
```

If you get a permission error, use:

```bash
sudo rm -rf /home/ec2-user/maven-web-application/target
```

---

### 🔹 **Step 2: Ensure no background process is using the file**

Check if something is still running and holding the WAR file:

```bash
lsof | grep maven-web-application.war
```

If you see a process, note the PID and stop it:

```bash
kill -9 <PID>
```

---

### 🔹 **Step 3: Run your build again**

```bash
mvn clean deploy -s /home/ec2-user/.m2/settings.xml
```

---

### 🔹 **Bonus: Check file permissions (if still stuck)**

Ensure you own the files:

```bash
sudo chown -R ec2-user:ec2-user /home/ec2-user/maven-web-application
```

And allow full access:

```bash
chmod -R 755 /home/ec2-user/maven-web-application
```

---

## ✅ Summary:

| Problem                              | Solution                                        |
|-------------------------------------|-------------------------------------------------|
| WAR file locked by a server         | `lsof`, `kill`, or stop server                  |
| Permissions prevent deletion        | Use `sudo rm -rf`, `chown`, and `chmod`         |
| Rebuild fails due to locked `target`| Delete `/target` folder manually                |


